{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
      "text": "Employment Ratio by State in Malaysia (2023)",
      "fontSize": 24,
      "fontWeight": "bold",
      "font": "Serif",
      "anchor": "start"
  },
  "width": 750,
  "height": 400,
  "projection": {
    "type": "mercator",
    "center": [109.5, 3],
    "scale": 2000
  },
  "layer": [
    {
      "data": {"sphere": true},
      "mark": {"type": "geoshape", "fill": "#e6f3ff"}
    },
    {
      "data": {"graticule": {"step": [1, 1]}},
      "mark": {"type": "geoshape", "fill": null, "stroke": "lightgray", "strokeWidth": 0.5}
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Kevinlkl/FIT3179_33522529_DV2/main/Datasets/malaysia_map.json",
        "format": {"type": "topojson", "feature": "my"}
      },
      "transform": [
        {
          "lookup": "properties.name",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/Kevinlkl/FIT3179_33522529_DV2/main/Datasets/lfs_2023_both.csv",
              "format": {"type": "csv"}
            },
            "key": "state",
            "fields": ["ep_ratio"]
          },
          "default": null
        }
      ],
      "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 1},
      "params": [
        {
          "name": "hover",
          "select": {"type": "point", "on": "mouseover", "clear": "mouseout"}
        }
      ],
      "encoding": {
        "color": {
          "field": "ep_ratio",
          "type": "quantitative",
          "scale": {
            "type": "quantile",
            "range": ["#e5f5e0", "#a1d99b", "#74c476", "#41ab5d", "#238b45"],
            "domain": [50, 80]
          },
          "legend": {"title": "Ratio (%)", "values": [0, 50, 60, 70, 80], "orient": "bottom-right"}
        },
        "stroke": {
          "condition": {"param": "hover", "empty": false, "value": "#333333"},
          "value": "white"
        },
        "strokeWidth": {
          "condition": {"param": "hover", "empty": false, "value": 3},
          "value": 1
        },
        "tooltip": [
          {"field": "properties.name", "type": "nominal", "title": "State"},
          {"field": "ep_ratio", "type": "quantitative", "title": "Employment Ratio (%)", "format": ".1f"}
        ]
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Kevinlkl/FIT3179_33522529_DV2/main/Datasets/lfs_2023_both.csv",
        "format": {"type": "csv"}
      },
      "transform": [
        { "filter": "datum.state == 'Selangor'" },
        { "calculate": "101.5", "as": "stateLon" },   
        { "calculate": "3.0", "as": "stateLat" },
        { "calculate": "toNumber(datum.stateLon) - 1.5", "as": "labelLon" },
        { "calculate": "toNumber(datum.stateLat) - 2.9", "as": "labelLat" },
        { "calculate": "'Selangor, KL & Putrajaya are major;industrial, financial & government hubs'", "as": "labelRaw" },
        { "calculate": "split(datum.labelRaw, ';')", "as": "labelLines" }
      ],
      "layer": [
        {
          "mark": {"type": "rule", "color": "#2E86AB", "strokeWidth": 1},
          "encoding": {
            "longitude": {"field": "stateLon"},
            "latitude": {"field": "stateLat"},
            "longitude2": {"field": "labelLon"},
            "latitude2": {"field": "labelLat"}
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "dx": 0,
            "dy": -3,
            "fontSize": 24,
            "stroke": "whitesmoke",
            "strokeWidth": 10
          },
          "encoding": {
            "longitude": {"field": "labelLon"},
            "latitude": {"field": "labelLat"},
            "text": {"value": "|||||||||||||||||||||||||||||||||||||||"
            }
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "dx": 5,
            "dy": -10,
            "fontSize": 12,
            "fill": "#111"
          },
          "encoding": {
            "longitude": {"field": "labelLon"},
            "latitude": {"field": "labelLat"},
            "text": {"field": "labelLines"}
          }
        }
      ]
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/Kevinlkl/FIT3179_33522529_DV2/main/Datasets/lfs_2023_both.csv",
        "format": {"type": "csv"}
      },
      "transform": [
        { "filter": "datum.state == 'Kelantan'" },
        { "calculate": "102.2", "as": "stateLon" },     
        { "calculate": "5.8", "as": "stateLat" },
        { "calculate": "toNumber(datum.stateLon) + 1.8", "as": "labelLon" },
        { "calculate": "toNumber(datum.stateLat) + 0.5", "as": "labelLat" },
        { "calculate": "'Kelantan is still heavily reliant on agriculture; which leads to a lot of informal/self-employment'", "as": "labelRaw" },
        { "calculate": "split(datum.labelRaw, ';')", "as": "labelLines" }
      ],
      "layer": [
        {
          "mark": {"type": "rule", "color": "#2E86AB", "strokeWidth": 1},
          "encoding": {
            "longitude": {"field": "stateLon"},
            "latitude": {"field": "stateLat"},
            "longitude2": {"field": "labelLon"},
            "latitude2": {"field": "labelLat"}
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "dx": 0,
            "dy": -3,
            "fontSize": 26,
            "stroke": "whitesmoke",
            "strokeWidth": 10
          },
          "encoding": {
            "longitude": {"field": "labelLon"},
            "latitude": {"field": "labelLat"},
            "text": {"value": "|||||||||||||||||||||||||||||||||||||||"
            }
          }
        },
        {
          "mark": {
            "type": "text",
            "align": "left",
            "dx": 5,
            "dy": -10,
            "fontSize": 12,
            "fill": "#111"
          },
          "encoding": {
            "longitude": {"field": "labelLon"},
            "latitude": {"field": "labelLat"},
            "text": {"field": "labelLines"}
          }
        }
      ]
    }
  ]
}