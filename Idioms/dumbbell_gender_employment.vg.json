{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Employment-to-Population Ratio (Male vs Female) by State",
    "fontSize": 24,
    "fontWeight": "bold",
    "font": "Serif",
    "anchor": "start"
  },
  "width": 970,
  "height": { "step": 26 },
  "data": {
    "url": "https://raw.githubusercontent.com/Kevinlkl/FIT3179_33522529_DV2/main/Datasets/lfs_state_sex.csv",
    "format": { "type": "csv", "parse": { "date": "date", "ep_ratio": "number" } }
  },
  "params": [
    {
      "name": "year_select",
      "value": 2023,
      "bind": { "input": "range", "min": 1982, "max": 2023, "step": 1, "name": "Year: " }
    }
  ],
  "transform": [
    { "calculate": "year(datum.date)", "as": "Year" },
    { "calculate": "lower(datum.sex)", "as": "sex_l" },
    { "filter": "datum.sex_l == 'male' || datum.sex_l == 'female'" },
    { "filter": "datum.Year == year_select" },
    { "pivot": "sex_l", "value": "ep_ratio", "groupby": ["state", "Year"] },
    { "calculate": "abs(datum.male - datum.female)", "as": "diff" },
    {
      "fold": ["male", "female"],
      "as": ["gender", "ep_value"]
    },
    {
      "calculate": "datum.gender == 'male' ? 'Male' : 'Female'",
      "as": "GenderLabel"
    }
  ],
  "layer": [
    {
      "mark": { "type": "rule", "strokeWidth": 2, "color": "#bdbdbd" },
      "encoding": {
        "y": { 
          "field": "state", 
          "type": "nominal", 
          "title": "State",
          "sort": { "field": "diff", "order": "descending" }
        },
        "x": {
          "aggregate": "min",
          "field": "ep_value",
          "type": "quantitative"
        },
        "x2": {
          "aggregate": "max",
          "field": "ep_value"
        }
      }
    },
    {
      "mark": { "type": "point", "filled": true, "size": 90 },
      "encoding": {
        "y": { "field": "state", "type": "nominal", "title": null },
        "x": { "field": "ep_value", "type": "quantitative", "title": "ep_ratio (%)" },
        "color": {
          "field": "GenderLabel",
          "type": "nominal",
          "scale": {
            "domain": ["Female", "Male"],
            "range": ["#e15759", "#4e79a7"]
          },
          "legend": {
            "orient": "bottom-left",
            "direction": "vertical",
            "title": null
          }
        },
        "tooltip": [
          { "field": "state", "title": "State" },
          { "field": "GenderLabel", "title": "Gender" },
          { "field": "ep_value", "title": "ep_ratio (%)", "format": ".1f" },
          { "field": "diff", "title": "Gap (pp)", "format": ".1f" }
        ]
      }
    }
  ],
  "config": {
    "axis": { "labelFontSize": 11, "titleFontSize": 12 },
    "view": { "stroke": null }
  }
}