{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "title": {
        "text": "Malaysia Trade: Import vs Export by Sector (2021-2024)",
        "fontSize": 20,
        "fontWeight": "bold",
        "font": "Serif",
        "anchor": "start"
    },
    "params": [
        {
            "name": "sector_selection",
            "bind": {
                "input": "select",
                "options": [
                    "Manufactures",
                    "Food",
                    "Agricultural raw materials",
                    "Fuel",
                    "Ores and metals"
                ],
                "name": "Select Sector: "
            },
            "value": "Manufactures"
        }
    ],
    "data": {
        "url": "https://raw.githubusercontent.com/Kevinlkl/FIT3179_33522529_DV2/main/Datasets/trade/mys_trade_indicators_filtered.csv",
        "format": {"type": "csv"}
    },
    "transform": [
        {
            "filter": "datum.Year == 2021 || datum.Year == 2022 || datum.Year == 2023 || datum.Year == 2024"
        },
        {
            "filter": "indexof(datum['Indicator Name'], sector_selection) >= 0"
        },
        {
            "calculate": "indexof(datum['Indicator Name'], 'imports') >= 0 ? 'Import' : 'Export'",
            "as": "Trade_Type"
        },
        {
            "aggregate": [
                {"op": "sum", "field": "Value", "as": "Total_Value"}
            ],
            "groupby": ["Year", "Trade_Type"]
        }
    ],
    "facet": {
        "field": "Year",
        "type": "ordinal",
        "title": "Year"
    },
    "spec": {
        "width": 150,
        "height": 150,
        "mark": {
            "type": "arc",
            "innerRadius": 0,
            "stroke": "white"
        },
        "encoding": {
            "theta": {
                "field": "Total_Value", 
                "type": "quantitative"
            },
            "color": {
                "field": "Trade_Type",
                "type": "nominal",
                "scale": {
                    "domain": ["Import", "Export"],
                    "range": ["#ff7f0e", "#1f77b4"]
                },
                "legend": {
                    "title": "Trade Type",
                    "titleFontSize": 12,
                    "labelFontSize": 11
                }
            },
            "strokeWidth": {
                "condition": {
                    "test": "datum.Trade_Type == 'Export'",
                    "value": 1
                },
                "value": 5
            },
            "tooltip": [
                {"field": "Trade_Type", "type": "nominal", "title": "Type"},
                {"field": "Total_Value", "type": "quantitative", "title": "Value (% of merchandise exports)", "format": ",.0f"}
            ]
        }
    },
    "resolve": {
        "scale": {
            "color": "independent"
        }
    }
}